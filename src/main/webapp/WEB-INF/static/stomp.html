

<!-- saved from url=(0045)http://dev.psj2867.com:8082/static/index.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.2/sockjs.min.js" integrity="sha512-ayb5R/nKQ3fgNrQdYynCti/n+GD0ybAhd3ACExcYvOR2J1o3HebiAe/P0oZDx5qwB+xkxuKG6Nc0AFTsPT/JDQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js" integrity="sha512-iKDtgDyTHjAitUDdLljGhenhPwrbBfqTKWO1mkhSFH3A7blITC9MhYon6SjnMhp4o0rADGw9yAC6EW4t5a4K3g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.24.0/axios.min.js" integrity="sha512-u9akINsQsAkG9xjc1cnGF4zw5TFDwkxuc9vUp5dltDWYCSmyd0meygbvgXrlc/z7/o4a19Fb5V0OUE58J7dcyw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
    <script>
        const info = a=>console.info(a);

        var baseEndpointUrl = "https://psj2867.com/api/ws/end?authToken=";
        var subUrl = "/sub/videos/1/comments";
        var pubUrl = "/pub/videos/1/comments";
        
        var stompClient = null;
        function connect(authToken){
            axios.get("https://psj2867.com/api/users/me/token",{headers: {Authorization : authToken}})
                    .then( response =>{
                        return response.data.accessToken;
                    }).then(tempAuthToekn => {
                        stompConnect(tempAuthToekn);
                    });
        }
        function stompConnect(tempAuthToekn) {
            var endpointUrl = baseEndpointUrl + tempAuthToekn;

            var socket = new SockJS(endpointUrl);

            stompClient = Stomp.over(socket);
            stompClient.connect(
                {},
                function (frame) {
                    console.log('Connected: ' + frame);
                    stompClient.subscribe(subUrl, function (data) {
                        showGreeting(JSON.parse(data.body));
                    });
                },
                function(message) {
                    console.log("Disconnected message!");      
                }
            );
        }

        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
            }
            console.log("Disconnected");
        }

        function send(msg) {
            // /app/hello로 JSON 파라미터를 메세지 body로 전송.
            stompClient.send(pubUrl, {}, JSON.stringify({'content': msg}));
            console.log("send : "+ msg);
        }

        function showGreeting(message) {  
            message.forEach(aL=>console.log(aL))
        }

    </script>

</body></html>